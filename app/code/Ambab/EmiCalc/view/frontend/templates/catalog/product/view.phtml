<?php 
    // $objectManager = \Magento\Framework\App\ObjectManager::getInstance();
    // $model=$objectManager->create('Ambab\EmiCalc\Model\Grid');
    // $datacollection=$model->getCollection();

    // get product price
    // $objectManager1 = \Magento\Framework\App\ObjectManager::getInstance();
    // $product = $objectManager1->get('Magento\Framework\Registry')->registry('current_product');    
    // $productprice=$product->getPrice();

    // created block file (get product price)
    $blockObj= $block->getLayout()->createBlock('Ambab\EmiCalc\Block\Catalog\Product\EmiPrice');
    $productprice= $blockObj->getProductPrice();
    $emiamtarray=[];
    ?>

<div id="information-mpdal" class="modal">
    <div id="element" class="accordiondata" data-mage-init='{"accordion":{"openedState": "active", "collapsible": true, "active": false, "multipleCollapsible": false}}'>
        <?php 
            $bankname=$blockObj->getBankName();
            foreach ($bankname as $namedata) { 
                $name = $namedata['Bank_Name'];
        ?>
        <div data-role="collapsible" class="accordionheader">
            <div data-role="trigger" class="titlediv">
                <h4 class="titleheader"><?php echo $name; ?></h4>
            </div>
        </div>
        <div data-role="content" class="contentdiv">
            <table class="table tablecontent">
                <thead>
                    <tr>
                        <th>Emi Plan</th>
                        <th>ROI</th>
                        <th>Intrest(pa)</th>
                        <th>Total Price</th>
                    </tr>
                </thead>
                <?php
                    $bankdata=$blockObj->getBankDetails($name);
                    foreach($bankdata as $data)
                    {
                        $months=$data['Emi_Plan'];
                        $roi=$data['Intrest'];
                        $finalroi=$roi/(12*100);
                        $emiamt=$blockObj->Emicalculation($productprice,$finalroi,$months);

                        array_push($emiamtarray,$emiamt);

                        $intrestamt=$emiamt*$months;
                        $intrestamt=$intrestamt-$productprice;
                ?>
                <tbody>
                    <tr>
                        <td><?php echo round($emiamt).' x '.$months.' Months'; ?></td>
                        <td><?php echo $data['Intrest'].'%'; ?></td>
                        <td><?php echo ceil($intrestamt).'$'; ?></td>
                        <td><?php echo round($productprice); ?></td>
                    </tr>
                </tbody>
                <?php   
                    }
                    $emismallamt=$blockObj->getSmallValue($emiamtarray);
                ?>
            </table>
        </div>
        <?php   
            }
        ?>
    </div>
</div>


<?php if ($block->canShowBlock()): ?>

    <a id="request-more" href="#">Emi strarts from <?php echo round($emismallamt).'$'; ?></a>

<?php endif; ?>






